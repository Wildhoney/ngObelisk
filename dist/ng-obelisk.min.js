/*! ng-obelisk by Adam Timberlake <adam.timberlake@gmail.com> created on 2014-04-08 */
!function(a){"use strict";var b=a.module("ngObelisk",[]);b.service("obelisk",["$rootScope","$window","$timeout",function(a,b,c){function d(a,b){this.object=a,this.p3d=b}function e(){var a=this;this.sanityCheck=function(){for(var a=["dimension","color"],b=function(a){return h===a.object[g]},c=0;c<f.objects.length;c++)for(var d=f.objects[c].object,e=0;e<a.length;e++){var g=a[e],h=d[g],i=f.objects.filter(b);if(i.length>1)throw"ngObelisk: "+i.length+" objects have the same '"+g+"' reference."}},this.PixelView=function(b,c){function e(){this.renderObject=function(a,b){g.renderObject(a,b);var c=new d(a,b);return f.objects.push(c),c}}var g=a.__proto__.PixelView.prototype;return f.pixelView=g,a.__proto__.PixelView.apply(g,[b,c]),new e}}var f={};return f.objects=[],f.timeout=null,f.pixelView={},f._prepareChanges=function(){c.cancel(f.timeout),f.timeout=c(f._commitChanges,1)},f._commitChanges=function(){var c=(new b.Date).getTime();f.pixelView.clear();for(var d=0;d<f.objects.length;d++){var e=f.objects[d].object,g=f.objects[d].p3d,h=e.toString().replace(/[^a-z]+/gi,"");if("undefined"==typeof obelisk[h])throw"ngObelisk: unable to find object of type '"+h+"'.";f.pixelView.renderObject(new obelisk[h](e.dimension,e.color,e.border),g)}var i=(new b.Date).getTime()-c,j=1e3/i;a.$broadcast("obelisk/fps",j)},d.prototype={object:{},p3d:{},setPosition:function(a){f._prepareChanges(),this.p3d=a},setColour:function(a){f._prepareChanges(),this.object.color=a},setX:function(a){f._prepareChanges(),this.object.dimension.xAxis=a},setY:function(a){f._prepareChanges(),this.object.dimension.yAxis=a},setZ:function(a){f._prepareChanges(),this.object.dimension.zAxis=a},remove:function(){f._prepareChanges();var a=f.objects.indexOf(this);f.objects.splice(a,1)}},e.prototype=b.obelisk,new e}])}(window.angular);